{
    "contents" : "---\ntitle: 'dynsim: An R implementation of dynamic simulations of autoregressive relationships.'\nauthor: Laron K Williams, Guy D Whitten, and [Christopher Gandrud](http://christophergandrud.blogspot.com/p/biocontact.html)\ndate: 1 March 2014\noutput:\n  html_document:\n    highlight: kate\n    theme: spacelab\n    toc: yes\n---\n\nVersion 0.2.3\n\nFork it on [GitHub](https://github.com/christophergandrud/dynsim)\n\n---\n\n## About \n\nThe **dynsim** package underdevelopment implements Williams and Whitten's ([2011](http://www.stata-journal.com/article.html?article=st0242), [2012](http://web.missouri.edu/~williamslaro/Williams%20and%20Whitten%202012.pdf)) method for dynamic simulations of autoregressive relationships in R.\n\n## Process \n\nThere are four basic steps to use **dynsim** to create dynamic simulations of autoregressive relationships:\n\n1. *Estimate* your linear model using `zelig` from the [Zelig](http://gking.harvard.edu/zelig) package.\n\n2. *Set up starting values* for simulation scenarios and (optionally) shock values at particular iterations (e.g. points in forecasted time).\n\n3. *Simulate* these scenarios based on the estimated model using the `dynsim` function.\n\n4. *Plot* the simulation results with the `dynsimGG` function.\n\n\n## Examples\n\nTo see how dynsim works, let’s go through a few examples. We will use the Grunfeld (1958) data set. It is included with dynsim. \n\nFirst let's load the packages we will use:\n\n```{r message=FALSE}\nlibrary(dynsim)\nlibrary(DataCombine)\nlibrary(Zelig)\n```\n\nNow let's load the data:\n\n```{r}\ndata(grunfeld, package = 'dynsim')\n```\n\nThe linear regression model we will estimate is:\n\n\\[I_{it} = \\alpha + \\beta_{1}I_{it-1} + \\beta_{2}F_{it} + \\beta_{3}C_{it} + \\mu_{it} \\]\n\nwhere $I_{it}$ is real gross investment for firm $i$ in year $t$. $I_{it-1}$ is the firm's investment in the previous year. $F_{it}$ is the real value of the firm and $C_{it}$ is the real value of the capital stock.  \n\nIn the `grunfeld` data set real gross investment is denoted `invest`, the firm's market value is `mvalue`, and the capital stock is `kstock`. There are 10 large US manufacturers from 1935-1954 in the data set. The variable identifying the individual companies is called `company`. We can easily create the investment one-year lag using the `slide` command from the [DataCombine](https://github.com/christophergandrud/DataCombine) package. Here is the code:\n\n```{r, message=FALSE}\ngrunfeld <- slide(grunfeld, Var = 'invest', GroupVar = 'company',\n               NewVar = 'InvestLag')\n```\n\nThe new lagged variable is called `InvestLag`.\n\n### Dynamic simulation without shocks\n\nNow that we have created our lag variable we, can begin to create dynamic simulations with **dynsim** by estimating the underlying linear regression model using **Zelig**, i.e.:\n\n```{r, message=FALSE}\nM1 <- zelig(invest ~ InvestLag + mvalue + kstock,\n            model = 'ls', data = grunfeld, cite = FALSE)\n```\n\nWe can use the resulting model object M1 in the dynsim command to run our dynamic simulations. We first need to create a list object containing data frames with starting values for each simulation scenario. Imagine we want to run three contrasting scenarios with the following fitted values:\n\n- Scenario 1: mean lagged investment, market value and capital stock held at their 95th percentiles,\n\n- Scenario 2: all variables held at their means,\n\n- Scenario 3: mean lagged investment, market value and capital stock held at their 5th\npercentiles.\n\nWe can create a list object for the scen argument containing each of these scenarios with the following code:\n\n```{r message=FALSE}\n# Create simulation scenarios\nattach(grunfeld)\nScen1 <- data.frame(InvestLag = mean(InvestLag, na.rm = TRUE),\n                    mvalue = quantile(mvalue, 0.95),\n                    kstock = quantile(kstock, 0.95))\nScen2 <- data.frame(InvestLag = mean(InvestLag, na.rm = TRUE),\n                    mvalue = mean(mvalue),\n                    kstock = mean(kstock))\nScen3 <- data.frame(InvestLag = mean(InvestLag, na.rm = TRUE),\n                    mvalue = quantile(mvalue, 0.05),\n                    kstock = quantile(kstock, 0.05))\ndetach(grunfeld)\n# Combine into a single list\nScenComb <- list(Scen1, Scen2, Scen3)\n```\n\nIn this example we won’t introduce shocks, so now we run our simulations:\n\n```{r}\nSim1 <- dynsim(obj = M1, ldv = 'InvestLag', scen = ScenComb, n = 20)\n```\n\nThis took 1000 draws of the coefficients to produce 20 dynamic simulation iterations for each of the three scenarios. In the resulting `Sim1` object we have retained the middle 95% and 50%. We will return to presenting and exploring the contents of `Sim1` later in this section.\n\n### Dynamic simulation with shocks\n\nNow let’s include fitted shock values. In particular, let’s see how a company with capital stock in the 5th percentile is predicted to change its gross investment when its market value experiences shocks compared to a company with capital stock in the 95th percentile. We will use market values for the first company in the grunfeld data set over the first 15 years as the shock values. To create the shock data use the following code:\n\n```{r, message=FALSE}\n# Keep only the mvalue for the first company for the first 15 years\ngrunfeldsub <- subset(grunfeld, company == 1)\ngrunfeldshock <- grunfeldsub[1:15, 'mvalue']\n\n# Create data frame for the shock argument\ngrunfeldshock <- data.frame(times = 1:15, mvalue = grunfeldshock)\n```\n\nNow we can simply add `grunfeldshock` to the dynsim shocks argument.\n\n```{r}\nSim2 <- dynsim(obj = M1, ldv = 'InvestLag', scen = ScenComb, n = 15,\n               shocks = grunfeldshock)\n```\n\nNow we can simply add grunfeldshock to the dynsim `shocks` argument.\n\n```{r}\nSim3 <- dynsim(obj = M1, ldv = 'InvestLag', scen = ScenComb, n = 15,\n               shocks = grunfeldshock)\n```\n\n### Plotting simulations\n\nProbably the easiest and most effective way to communicate your dynsim simulation results is with the package’s built-in plotting capabilities. These are accessed with the `dysnsimGG` command. Let’s start by plotting the simulations from our basic model. In an earlier example we put these results into `Sim1`. Using `dynsimGG`'s default settings we can plot the simulations with the following code:\n\n```{r fig.align='center'}\ndynsimGG(Sim1)\n```\n\nWe can make a number of aesthetic changes. For example, we can re-title the legend using the `leg.name` argument and change the legend values by adding a vector of the desired label names in the order of our scenarios using the `leg.labels` argument. We can also change the color palette using the `color` argument. Let’s use the 'orange-red' palette denoted by `OrRd`. Finally, we can change the y-axis label with the `ylab` argument so that it is more descriptive. \n\n```{r fig.align='center'}\n# Create legend labels vector\nLabels <- c('95th Percentile', 'Mean', '5th Percentile')\n# Plot\ndynsimGG(Sim1, leg.name = 'Scenarios', leg.labels = Labels, color = 'OrRd',\n         ylab = 'Predicted Real Gross Investment\\n')\n```\n\nPlotting simulations with shock variables is very similar to what we have already seen. The one major change we can make is to include a plot of one shock variable’s fitted values underneath the main plot. To do this simply use the `shockplot.var` argument to specify which variable to plot. Use the `shockplot.ylab` argument to change the y-axis label. For example:\n\n```{r fig.align='center'}\ndynsimGG(Sim2, leg.name = 'Scenarios', leg.labels = Labels, color = 'OrRd',\n       ylab = 'Predicted Real Gross Investment\\n', shockplot.var = 'mvalue',\n       shockplot.ylab = 'Firm Value')\n```\n\nSimilarly, we can plot the simulations from scenarios where market value shocks were interacted with capital stock. The code is accomplish this is almost identical to the code chunk we just saw. The only difference is that we use the `Sim3` model object.\n\n```{r fig.align='center'}\ndynsimGG(Sim3, leg.name = 'Scenarios', leg.labels = Labels, color = 'OrRd',\n       ylab = 'Predicted Real Gross Investment\\n', shockplot.var = 'mvalue',\n       shockplot.ylab = 'Firm Value')\n```\n\n## Install\n\n**dynsim** is available on [CRAN](http://cran.r-project.org/web/packages/dynsim/index.html)\n\nYou can also easily install the latest development version with the [devtools](http://cran.r-project.org/web/packages/devtools/index.html) package:\n\n```{r eval=FALSE}\ndevtools::install_github('dynsim', 'christophergandrud')\n```\n",
    "created" : 1393692130126.000,
    "dirty" : false,
    "encoding" : "UTF-8",
    "folds" : "",
    "hash" : "3023873678",
    "id" : "A7916B5",
    "lastKnownWriteTime" : 1393692133,
    "path" : "/git_repositories/dynsim/index.Rmd",
    "project_path" : "index.Rmd",
    "properties" : {
    },
    "source_on_save" : false,
    "type" : "r_markdown"
}